name: Package Modpack

on:
  push:
    branches:
      - master  # master branch
    tags:
      - '*'   # Stále sa spustí aj pri vytvorení tagu (voliteľné)

jobs:
  package:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Create Client and Server ZIPs
        run: |
          # --- PRÍPRAVA KLIENTA ---
          mkdir modpack_client
          cp -r bin config mods resources scripts servers.dat modpack_client/
          cd modpack_client
          zip -r ../modpack_client.zip ./*
          cd ..

          # --- PRÍPRAVA SERVERA ---
          mkdir modpack_server
          cp -r bin config mods resources scripts servers.dat modpack_server/
          
          # Odstránenie grafických módov a problémového Starlightu
          rm -f modpack_server/mods/*embeddium*
          rm -f modpack_server/mods/*embedium*
          rm -f modpack_server/mods/*rubidium*
          rm -f modpack_server/mods/*oculus*
          rm -f modpack_server/mods/*starlight*
          
          cd modpack_server
          zip -r ../modpack_server.zip ./*
          cd ..

      - name: Upload Release Asset
        uses: softprops/action-gh-release@v1
        with:
          # Ak ide o push na main, vytvorí/upraví tag "latest"
          # Ak ide o tag, použije názov tagu
          tag_name: ${{ github.ref_type == 'tag' && github.ref_name || 'latest' }}
          files: |
            modpack_client.zip
            modpack_server.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
